---
title: "serac"
author: "Rosalie Bruel"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: yes
vignette: >
  %\VignetteIndexEntry{serac}
  \usepackage[utf8]{inputenc}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
stopifnot(require(knitr))
knitr::opts_chunk$set(collapse = T, comment = "#>")
options(tibble.print_min = 4L, tibble.print_max = 4L,width = 90)
opts_chunk$set(
  comment = NA,
  message = FALSE,
  warning = FALSE,
  eval = FALSE,
  dev = "png",
  dpi = 150,
  fig.asp = 0.8,
  fig.width = 5,
  out.width = "100%",
  fig.align = "center"
)

library(devtools)
devtools::install_github("rosalieb/serac")
library(serac)

```

The present vignette helps you compute your first age-depth model with _serac_, a R package for ShortlivEd RAdionuclide Chronology of recent sediment cores.

## First time user - setting up the folders

Which folder are your currently working in?

```{r eval=FALSE}
getwd()
```

If you want to work in another folder, change it with setwd(""), e.g.:

```{r eval=FALSE}
setwd("/myProject/Age depth model")
```


Line below will create the 'Cores' folder if it doesn't exist already
```{r eval=TRUE}
dir.create(file.path(getwd(), 'Cores'), showWarnings = FALSE)
```

Within the 'Cores' folder, user needs to create one folder per core.
```{r eval=TRUE}
dir.create(file.path(paste(getwd(),'/Cores',sep=""), 'serac_example_ALO09P12'), showWarnings = FALSE)

```

We are writing in this subfolder an example dataset.

Format your own data following this template, or get help with formatting using the serac_input_formatting() function

```{r eval=TRUE}
?serac_example_ALO09P12
write.table(x = serac_example_ALO09P12, file = paste(getwd(),'/Cores/serac_example_ALO09P12/serac_example_ALO09P12.txt',sep=""),col.names = T, row.names = F,sep="\t")

# Including proxy data for this core too
write.table(x = serac_example_ALO09P12_proxy, file = paste(getwd(),'/Cores/serac_example_ALO09P12/serac_example_ALO09P12_proxy.txt',sep=""),col.names = T, row.names = F,sep="\t")

```





## Run serac
At the minimum, your function will be need the name of the core and the coring year. In the example below, I included the **save_code** argument because Rmarkdown doesn't save code history the way the code can use it. Unless you're including a plot in a Rmarkdown, I recommend you do not specify this argument, or turn it to its default, i.e., TRUE. That way, you can go back and see your code.

```{r eval=TRUE}
serac(name="serac_example_ALO09P12",coring_yr=2009,
      save_code=FALSE) #do not include this in the code if you're working outside a Rmarkdown
```

Several sedimentation hypotheses were tested, and this is what the author chose as the best model:
```{r echo=TRUE}
serac(name="serac_example_ALO09P12", coring_yr=2009, model=c("CFCS"),
      plotphoto=FALSE, minphoto=c(0), maxphoto=c(210),
      plot_Pb=T, plot_Am=T, plot_Cs=T, Cher=c(30,40), Hemisphere=c("NH"), NWT=c(51,61),
      sedchange=c(75.5),
      plot_Pb_inst_deposit=T, inst_deposit=c(20,28,100,107,135,142,158,186),
      suppdescriptor=TRUE, descriptor_lab=c("Ca/Fe"),
      historic_d=c(20,28,100,107,135,142,158,186), historic_a=c(1994,1920,1886,1868), historic_n=c("sept 1994 flood","1920 flood","1886 flood","1868 flood ?"), 
      min_yr=c(1750),
      dmax=c(180), 
      plotpdf=F, preview=T,
      save_code=FALSE)

```

If you want to see the preview, change preview=T in the code.
Before that, make sure to extend your window in RStudio (large plot!)




## Explore outputs
Files with age-depth model and metadata are automatically saved in your working folder. If you assign your function to an object, serac will return a list with the parameters.

```{r eval=TRUE}
mymodel1 <- serac(name="serac_example_ALO09P12", coring_yr=2009, preview = T,save_code=FALSE)

```

Several objects are accessible from the object **mymodel1**:
`r paste("</br>    - ",names(mymodel1))`



```{r eval=TRUE}
mymodel1$plot 

# Visualize the input data
knitr::kable(mymodel1$data, format = "markdown")

# Visualize the inventories (if density was in the input data file)
mymodel1$Inventories

# Save the plot with custom parameters, e.g., Courier font and grey scale without editing default colors.
pdf(paste0(getwd(),"/Cores/serac_example_ALO09P12/serac_example_ALO09P12_custom.pdf"),width = 10, height = 5, family="Courier", colormodel = "grey")
mymodel1$plot
dev.off()

```

```{r include=FALSE}
# remove folder that was created for compilation of this vignette.
unlink(paste0(getwd(),"/Cores"), recursive = TRUE)
```

```{r eval=FALSE, include=FALSE}
# run that line to build vignette
devtools::build_vignettes()
```

